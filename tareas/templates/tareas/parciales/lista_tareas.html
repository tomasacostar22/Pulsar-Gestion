<!-- Header con boton crear -->
<div class="flex items-center justify-between mb-4">
  <h2 class="text-xl font-bold text-indigo-900">
    {% if vista == 'propias' %}Tareas propias
    {% elif vista == 'asignadas' %}Asignadas a mi
    {% else %}Tareas que superviso{% endif %}
  </h2>
  {% if vista == 'propias' %}
  <a
    href="{% url 'crear_tarea' %}?modo=propia"
    class="bg-indigo-600 hover:bg-indigo-700 text-white text-sm font-semibold px-4 py-2 rounded-lg transition"
  >
    + Nueva tarea
  </a>
  {% elif vista == 'supervisar' %}
  <a
    href="{% url 'crear_tarea' %}"
    class="bg-indigo-600 hover:bg-indigo-700 text-white text-sm font-semibold px-4 py-2 rounded-lg transition"
  >
    + Asignar tarea
  </a>
  {% endif %}
</div>

<!-- Filtro por estado -->
<div class="flex gap-2 mb-6">
  <a
    href="?vista={{ vista }}&estado=PENDIENTE"
    hx-get="/tareas/?vista={{ vista }}&estado=PENDIENTE"
    hx-target="#contenido-tareas"
    hx-push-url="true"
    class="px-3 py-1.5 rounded-full text-xs font-medium transition {% if estado == 'PENDIENTE' %}bg-yellow-400 text-yellow-900{% else %}bg-yellow-100 text-yellow-700 hover:bg-yellow-200{% endif %}"
  >
    Pendientes
  </a>
  <a
    href="?vista={{ vista }}&estado=FINALIZADA"
    hx-get="/tareas/?vista={{ vista }}&estado=FINALIZADA"
    hx-target="#contenido-tareas"
    hx-push-url="true"
    class="px-3 py-1.5 rounded-full text-xs font-medium transition {% if estado == 'FINALIZADA' %}bg-emerald-500 text-white{% else %}bg-emerald-100 text-emerald-700 hover:bg-emerald-200{% endif %}"
  >
    Finalizadas
  </a>
  <a
    href="?vista={{ vista }}&estado=CANCELADA"
    hx-get="/tareas/?vista={{ vista }}&estado=CANCELADA"
    hx-target="#contenido-tareas"
    hx-push-url="true"
    class="px-3 py-1.5 rounded-full text-xs font-medium transition {% if estado == 'CANCELADA' %}bg-red-500 text-white{% else %}bg-red-100 text-red-700 hover:bg-red-200{% endif %}"
  >
    Canceladas
  </a>
</div>

<!-- Lista de tareas -->
{% if tareas %}
<div class="space-y-3">
  {% for tarea in tareas %}
  <div class="bg-white rounded-xl border border-indigo-100 shadow-sm p-5">
    <div class="flex items-center justify-between mb-1">
      <div class="flex items-center gap-3">
        <h3 class="font-semibold text-indigo-900">{{ tarea.nombre }}</h3>
        <span class="text-xs px-2 py-0.5 rounded-full font-medium
          {% if tarea.prioridad == 'ALTA' %}bg-red-100 text-red-700
          {% elif tarea.prioridad == 'MEDIA' %}bg-yellow-100 text-yellow-700
          {% else %}bg-green-100 text-green-700{% endif %}
        ">{{ tarea.get_prioridad_display }}</span>
        <span class="text-xs px-2 py-0.5 rounded-full font-medium
          {% if tarea.estado == 'FINALIZADA' %}bg-emerald-100 text-emerald-700
          {% elif tarea.estado == 'CANCELADA' %}bg-red-100 text-red-700
          {% else %}bg-yellow-100 text-yellow-700{% endif %}
        ">{{ tarea.get_estado_display }}</span>
      </div>
      {% if tarea.estado == 'PENDIENTE' %}
        {% if vista == 'propias' or vista == 'asignadas' %}
        <button
          hx-post="/tareas/{{ tarea.id }}/finalizar/?vista={{ vista }}&estado={{ estado }}"
          hx-target="#contenido-tareas"
          hx-swap="innerHTML"
          class="bg-emerald-500 hover:bg-emerald-600 text-white text-xs font-semibold px-3 py-1.5 rounded-lg transition"
        >
          Finalizar
        </button>
        {% elif vista == 'supervisar' %}
        <button
          hx-post="/tareas/{{ tarea.id }}/cancelar/?vista={{ vista }}&estado={{ estado }}"
          hx-target="#contenido-tareas"
          hx-swap="innerHTML"
          class="bg-red-500 hover:bg-red-600 text-white text-xs font-semibold px-3 py-1.5 rounded-lg transition"
        >
          Cancelar
        </button>
        {% endif %}
      {% endif %}
    </div>
    {% if tarea.descripcion %}
    <p class="text-sm text-indigo-500 mb-2">{{ tarea.descripcion }}</p>
    {% endif %}
    <div class="flex gap-4 text-xs text-indigo-400">
      {% if vista == "supervisar" %}
      <span>Responsable: {{ tarea.responsable.get_full_name }}</span>
      {% elif vista == "asignadas" %}
      <span>Supervisor: {{ tarea.supervisor.get_full_name }}</span>
      {% endif %}
      <span>Limite: {{ tarea.fecha_limite|date:"d/m/Y" }}</span>
    </div>
  </div>
  {% endfor %}
</div>
{% else %}
<div class="text-center py-16 text-indigo-300">
  <p class="text-lg">No hay tareas por aqui.</p>
</div>
{% endif %}
